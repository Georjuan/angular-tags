/*! angular-tags - v0.3.1 - 2014-07-27
* http://boneskull.github.io/angular-tags
* Copyright (c) 2014 Christopher Hiller <chiller@badwing.com>
 Licensed MIT */
!function(a,b){"use strict";!function(){try{b.module("badwing.tags.templates")}catch(a){b.module("badwing.tags.templates",[])}var c=b.module("badwing.tags",["ui.bootstrap.typeahead","badwing.tags.templates"]),d={delimiter:",",classes:{}},e=/^\s*(.*?)(?:\s+as\s+(.*?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+(.*)$/,f={enter:13,esc:27,backspace:8},g=[f.enter],h=[f.backspace],i=[f.esc],j=0;c.constant("decipherTagsOptions",{}),c.controller("TagsCtrl",["$scope","$timeout","$q",function(a,c,d){a.getClasses=function(c){var d={};return c===a.toggles.selectedTag&&(d.selected=!0),b.forEach(a.options.classes,function(a,b){c.group===b&&(d[a]=!0)}),d},a._filterSrcTags=function(b){return c(function(){var c=a.srcTags.indexOf(b);return c>=0?(a.srcTags.splice(c,1),void a._deletedSrcTags.push(b)):d.reject()})},a.add=function(b){var c,e=function(b){a.tags.push(b),delete a.inputTag,a.$emit("badwing.tags.added",{tag:b,$id:a.$id})},f=function(){a.$emit("badwing.tags.addfailed",{tag:b,$id:a.$id}),g.reject()},g=d.defer();for(c=a.tags.length;c--;)a.tags[c].name===b.name&&f();return a._filterSrcTags(b).then(function(){e(b)},function(){a.options.addable?(e(b),g.resolve()):f()}),g.promise},a.selectArea=function(){a.toggles.inputActive=!0},a.remove=function(b){var c;a.tags.splice(a.tags.indexOf(b),1),(c=a._deletedSrcTags.indexOf(b)>=0)&&(a._deletedSrcTags.splice(c,1),-1===a.srcTags.indexOf(b)&&a.srcTags.push(b)),delete a.toggles.selectedTag,a.$emit("badwing.tags.removed",{tag:b,$id:a.$id})}}]),c.directive("decipherTagsInput",["$timeout","$filter","$rootScope",function(a,b,c){return{restrict:"C",require:"ngModel",link:function(d,e,f,j){var k=new RegExp("^"+d.options.delimiter+"+$"),l=function(){j.$setViewValue(""),j.$render()},m=function(a){if(a){if(a.match(k))return void l();d.add({name:a})&&l()}},n=function(a){var b;for(b=0;b<a.length;b++)m(a[b])},o=function(){var a;d.toggles.selectedTag?(d.remove(d.toggles.selectedTag),delete d.toggles.selectedTag):j.$viewValue||(a=b("orderBy")(d.tags,d.orderBy),d.toggles.selectedTag=a[a.length-1])};e.bind("focus",function(){c.$$phase?delete d.toggles.selectedTag:d.$apply(function(){delete d.toggles.selectedTag})}),e.bind("keypress",function(a){d.$apply(function(){d.options.delimiter.charCodeAt()===a.which&&m(j.$viewValue)})}),e.bind("keydown",function(a){d.$apply(function(){g.indexOf(a.which)>=0?m(j.$viewValue):i.indexOf(a.which)>=0&&!a.isPropagationStopped()?(l(),d.toggles.inputActive=!1):h.indexOf(a.which)>=0?o():(delete d.toggles.selectedTag,d.$emit("badwing.tags.keyup",{value:j.$viewValue,$id:d.$id}))})}),d.$watch("toggles.inputActive",function(b){b&&a(function(){e[0].focus()})}),j.$parsers.unshift(function(a){var b=a.split(d.options.delimiter);return b.length>1&&n(b),a.match(k)?void e.val(""):a}),j.$formatters.push(function(a){return a&&a.value?void e.val(""):a})}}}]),c.directive("tags",["$document","$timeout","$parse","decipherTagsOptions",function(a,c,f,g){return{controller:"TagsCtrl",restrict:"E",replace:!0,template:"<div><div data-ng-include=\"'tags.html'\"></div></div>",scope:{model:"="},link:function(a,c,h){var i,k,l,m,n,o,p,q,r=!1,s=!1,t=b.copy(d),u=b.copy(g),v=function(a){var b=a.match(e);if(!b)throw new Error("Expected src specification in form of '_modelValue_ (as _label_)? for _item_ in _collection_' but got '"+a+"'.");return{itemName:b[3],source:f(b[4]),sourceName:b[4],viewMapper:f(b[2]||b[1]),modelMapper:f(b[1])}},w=function(){p=a.$watch("model",function(c){var d,e;if(b.isDefined(c)){for(n(),a.tags=y(c),m=a.tags.length;m--;)a._filterSrcTags(a.tags[m]);for(m=a._deletedSrcTags.length;m--;)d=a._deletedSrcTags[m],(e=-1===c.indexOf(d)&&-1===a.srcTags.indexOf(d))&&(a.srcTags.push(d),a._deletedSrcTags.splice(m,1));x()}},!0)},x=function(){n=a.$watch("tags",function(c,d){var e;if(c!==d){if(p(),s||r){if(c=c.map(function(a){return a.name}),b.isArray(a.model))for(a.model.length=0,e=0;e<c.length;e++)a.model.push(c[e]);r&&(a.model=c.join(a.options.delimiter))}else for(a.model.length=0,e=0;e<c.length;e++)a.model.push(c[e]);w()}},!0)},y=function(c){var d=[];if(!b.isUndefined(c)){if(b.isString(c))d=c.split(a.options.delimiter).map(function(a){return{name:a.trim()}});else if(b.isArray(c))d=c.map(function(a){return b.isString(a)?{name:a.trim()}:(a.name&&(a.name=a.name.trim()),a)});else if(b.isDefined(c))throw"list of tags must be an array or delimited string";return d}},z=function A(){var c,d,e,f;if(a.options.addable=a.options.addable||!1,a.srcTags=[],i=v(h.src),k=i.source(a.$parent),!b.isUndefined(k)){if(b.isFunction(o)&&o(),c={},b.isDefined(k))for(d=0;d<k.length;d++)c[i.itemName]=k[d],f={},f.value=i.modelMapper(a.$parent,c),e={},e=b.isObject(f.value)?b.extend(f.value,{name:i.viewMapper(a.$parent,c),value:f.value.value,group:f.value.group}):{name:i.viewMapper(a.$parent,c),value:f.value,group:l},a.srcTags.push(e);o=a.$parent.$watch(i.sourceName,function(a,b){a!==b&&A()},!0)}};a.options=b.extend(t,b.extend(u,a.$eval(h.options))),a.orderBy=a.options.orderBy,a.toggles={inputActive:!1},a.$on("badwing.tags.sort",function(b,c){a.orderBy=c}),h.$observe("typeaheadOptions",function(b){a.typeaheadOptions=b?f(b)(a.$parent):{}}),q=a.model,b.isString(q)&&(r=!0),a.tags=[],a._deletedSrcTags=[],x(),w(),a.srcTags=[],b.isDefined(h.src)?z():a.options.addable=!0,a.$id=++j,a.$emit("badwing.tags.initialized",{$id:a.$id,model:a.model})}}}])}()}(window,window.angular);
//# sourceMappingURL=tags.min.map